{% extends "base.html" %}
{% block content %}
<div class="login-box">
  <div class="card card-outline card-primary">
    <div class="card-body">
      <h4 class="mb-3 text-center">Nova senha (Admin)</h4>

      {% if form.errors %}
        <div class="alert alert-danger">
          <ul>
            {% for field in form %}
              {% for error in field.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <form method="post">
        {% csrf_token %}
        <div class="form-group">
          {{ form.new_password1.label_tag }}
          {{ form.new_password1 }}
        </div>
        <div class="form-group">
          {{ form.new_password2.label_tag }}
          {{ form.new_password2 }}
        </div>
        <div class="mt-3">
          <button type="submit" class="btn btn-primary btn-block">Redefinir senha</button>
        </div>
      </form>
    </div>
  </div>
</div>


<script>
  // Se o caminho atual contiver "admin/password-reset-confirm" e vier com ?next=...
  if (window.location.href.includes('?next=/admin')) {
    // Redireciona para a p√°gina certa sem o next indesejado
    const url = window.location.href.replace(/\?next=.*$/, '');
    window.location.href = url;
  }
</script>

{% endblock %}
